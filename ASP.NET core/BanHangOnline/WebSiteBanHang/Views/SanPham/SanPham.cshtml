@using WebSiteBanHang.Models
@using PagedList.Mvc;

@model PagedList.IPagedList<SanPham>
@{
    ViewBag.Title = "SanPham";
    Layout = "~/Views/Layout/ProductLayout.cshtml";
}

<div class="col-md-9 product1">
    <div class=" bottom-product">
        @foreach (var item in Model)
        {
            <div style="margin-bottom:2em" class="col-md-4 bottom-cd simpleCart_shelfItem">
                <script>
            $(document).ready(function (c) {

                $('#@item.MaSP').on('click', function (c) {
                    $.ajax({
                            type: 'POST',
                            data: { MaSP: @item.MaSP },
                            url: '@Url.Action("ThemGioHang","GioHang")',
                            success: function (ketqua) {

                                $('#GioHang').html(ketqua);
                               
                            }
                        });
                });


            });
                </script>
                <div class="product-at ">
                    <a href="@Url.Action("ChiTietSanPham","SanPham",new { id = item.MaSP })">
                        <img style="width:250px; height:200px" class="img-responsive" src="@Url.Content("~/Content/HinhAnhSP/"+item.HinhAnh)" alt="">
                        <div class="pro-grid">
                            <span class="buy-in">Xem chi tiết</span>
                        </div>
                    </a>
                </div>
                <p class="tun"></p>
                <a type="submit" id="@item.MaSP" href="#" class="item_add"><p class="number item_price"><i> </i>@item.DonGia.Value.ToString("#,##") VNĐ</p></a>

                <p></p>
            </div>
        }


        <div class="clearfix"> </div>
    </div>


</div>
<div class="clearfix"> </div>
<nav class="in">
    <ul class="pagination">

        Trang @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber)/@Model.PageCount
        @Html.PagedListPager(Model, page => Url.Action("SanPham", new { page = page, @LSP = ViewBag.LoaiSP, @NSX = ViewBag.NhaSX }))

    </ul>
</nav>
@{

    ThanhVienTB tv = Session["TaiKhoan"] as ThanhVienTB;
    int status = 0;
    if (tv != null)
    {
        status = 1;
    }
}
@section scripts {
    
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->

    <script src="~/Scripts/jquery.signalR-2.4.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        var kt = @status;
        
        $(function () {

            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.chatHub;
            // Create a function that the hub can call back to display messages.
            chat.client.addNewMessageToPage = function (name, message) {
                // Add the message to the page.


                window.location.href = name;

            };
            // Get the user name and store it to prepend to messages.
            // $('#displayname').val(prompt('Enter your name:', ''));
            // Set initial focus to message input box.

            // Start the connection.
            $.connection.hub.start().done(function () {


                // Call the Send method on the hub.
                if (kt) {


                    $('#XemGioHang').click(function () {

                        chat.server.send('/GioHang/XemGioHang', '');
                    });

                }
                

            });


        });

        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }


    </script>
}


